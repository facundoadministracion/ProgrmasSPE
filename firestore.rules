rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Colecci√≥n de usuarios
    match /users/{userId} {
      
      function isAdmin() {
        return request.auth != null &&
               request.auth.token.email == "crnunezfacundo@gmail.com";
      }

      // Un usuario puede leer y escribir solo su propio documento
      allow read, update, delete: if request.auth != null && request.auth.uid == userId;

      // Un usuario puede crear su propio documento.
      allow create: if request.auth != null && request.auth.uid == userId;

      // El admin puede leer y escribir todo
      allow read, write: if isAdmin();
    }

    // Para el resto de las colecciones, solo el admin tiene acceso.
    // Esto previene lecturas no deseadas (ej. /config, /payments) antes de que la app sepa el rol del usuario.
    match /participants/{docId} {
       allow read, write: if request.auth != null && request.auth.token.email == "crnunezfacundo@gmail.com";
    }
    match /payments/{docId} {
       allow read, write: if request.auth != null && request.auth.token.email == "crnunezfacundo@gmail.com";
    }
    match /config/{docId} {
       allow read, write: if request.auth != null && request.auth.token.email == "crnunezfacundo@gmail.com";
    }
    match /novedades/{docId} {
       allow read, write: if request.auth != null && request.auth.token.email == "crnunezfacundo@gmail.com";
    }
     match /asistencias/{docId} {
       allow read, write: if request.auth != null && request.auth.token.email == "crnunezfacundo@gmail.com";
    }
  }
}
